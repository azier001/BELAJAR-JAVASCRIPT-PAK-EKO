# ğŸ”„ State di AJAX

## ğŸ“š Pengenalan

AJAX (Asynchronous JavaScript and XML) memiliki **tahapan state** yang berbeda-beda selama proses request berlangsung. Kita bisa memantau state ini menggunakan property `readyState`.

### ğŸ¯ Apa itu readyState?

Property `readyState` mengembalikan nilai **number** (angka), dimana setiap angka merupakan representasi dari state tertentu dalam proses AJAX.

---

## ğŸ“‹ Daftar State AJAX

Berikut adalah **5 state** yang ada di AJAX:

| Value | State | Description |
|-------|-------|-------------|
| **0** | `UNSENT` | Client has been created. `open()` not called yet. |
| **1** | `OPENED` | `open()` has been called. |
| **2** | `HEADERS_RECEIVED` | `send()` has been called, and headers and status are available. |
| **3** | `LOADING` | Downloading; `responseText` holds partial data. |
| **4** | `DONE` | The operation is complete. |

### ğŸ’¡ Penjelasan Setiap State:

- **State 0 (UNSENT)**: XMLHttpRequest baru saja dibuat, belum ada yang dilakukan
- **State 1 (OPENED)**: Koneksi dibuka dengan method `open()`
- **State 2 (HEADERS_RECEIVED)**: Request dikirim dan server sudah merespon dengan header
- **State 3 (LOADING)**: Sedang mengunduh data dari server
- **State 4 (DONE)**: Selesai! Data sudah diterima sepenuhnya

---

## ğŸ§ Ready State Change Event

### â“ Mengapa Perlu Event Ini?

Jika kita ingin **mendengarkan perubahan** yang terjadi pada state, kita bisa menggunakan event `readystatechange`. Event ini akan dipanggil setiap kali `readyState` berubah.

ğŸ“– **Referensi**: [MDN - onreadystatechange](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/onreadystatechange)

---

## ğŸ’» Contoh Kode 1: Memantau Ready State

### Kode:

```javascript
const ajax = new XMLHttpRequest();

// Cara 1: Menggunakan addEventListener
// ajax.addEventListener("readystatechange", callback)

// Cara 2: Menggunakan onreadystatechange (lebih simpel)
ajax.onreadystatechange = function () {
  console.info(`Ready State Change: ${ajax.readyState}`);
};
```

### ğŸ“ Penjelasan Kode:

1. **Baris 1**: Membuat objek XMLHttpRequest baru bernama `ajax`
2. **Baris 4**: Komentar menunjukkan cara alternatif menggunakan `addEventListener`
3. **Baris 7-9**: Menggunakan `onreadystatechange` untuk mendengarkan perubahan state
4. **Baris 8**: Setiap kali state berubah, akan mencetak nilai `readyState` ke console

### ğŸ“¤ Output:

```
(Belum ada output karena kita belum melakukan request)
```

---

## ğŸ’» Contoh Kode 2: Request AJAX Lengkap dengan State

### Kode:

```javascript
const ajax = new XMLHttpRequest();

// Monitor setiap perubahan state
ajax.onreadystatechange = function () {
  console.log(`State berubah menjadi: ${ajax.readyState}`);
  
  // Jika request selesai (state 4) dan berhasil (status 200)
  if (ajax.readyState === 4 && ajax.status === 200) {
    console.log("âœ… Data berhasil diterima!");
    console.log("Data:", ajax.responseText);
  }
};

// Buka koneksi ke API
ajax.open("GET", "https://jsonplaceholder.typicode.com/users/1", true);

// Kirim request
ajax.send();
```

### ğŸ“ Penjelasan Kode:

1. **Baris 1**: Membuat objek AJAX
2. **Baris 4-12**: Event handler yang berjalan setiap state berubah
3. **Baris 5**: Mencetak state saat ini
4. **Baris 8**: Mengecek apakah request sudah selesai (state 4) dan berhasil (status 200)
5. **Baris 9-10**: Jika berhasil, tampilkan data yang diterima
6. **Baris 15**: Membuka koneksi ke API dengan method GET
7. **Baris 18**: Mengirim request

### ğŸ“¤ Output Console:

```
State berubah menjadi: 1
State berubah menjadi: 2
State berubah menjadi: 3
State berubah menjadi: 4
âœ… Data berhasil diterima!
Data: {
  "id": 1,
  "name": "Leanne Graham",
  "username": "Bret",
  "email": "Sincere@april.biz",
  ...
}
```

---

## ğŸ’» Contoh Kode 3: Menampilkan Loading Indicator

### Kode:

```javascript
const ajax = new XMLHttpRequest();

ajax.onreadystatechange = function () {
  if (ajax.readyState === 1) {
    console.log("ğŸ”„ Membuka koneksi...");
  } 
  else if (ajax.readyState === 2) {
    console.log("ğŸ“¡ Header diterima...");
  } 
  else if (ajax.readyState === 3) {
    console.log("â³ Sedang mengunduh data...");
  } 
  else if (ajax.readyState === 4) {
    if (ajax.status === 200) {
      console.log("âœ… Selesai! Data diterima");
      console.log("Jumlah karakter data:", ajax.responseText.length);
    } else {
      console.log("âŒ Error:", ajax.status);
    }
  }
};

ajax.open("GET", "https://jsonplaceholder.typicode.com/posts", true);
ajax.send();
```

### ğŸ“ Penjelasan Kode:

1. **Baris 4-6**: Ketika state 1, koneksi sedang dibuka
2. **Baris 7-9**: Ketika state 2, header sudah diterima dari server
3. **Baris 10-12**: Ketika state 3, sedang proses download data
4. **Baris 13-19**: Ketika state 4:
   - Jika status 200: request berhasil
   - Jika bukan: ada error
5. **Baris 16**: Menampilkan panjang data yang diterima

### ğŸ“¤ Output Console:

```
ğŸ”„ Membuka koneksi...
ğŸ“¡ Header diterima...
â³ Sedang mengunduh data...
âœ… Selesai! Data diterima
Jumlah karakter data: 27503
```

---

## ğŸ¯ Kesimpulan

âœ¨ **Poin Penting:**

- AJAX memiliki **5 state** (0-4) yang menunjukkan tahapan proses request
- Gunakan `readyState` untuk mengecek state saat ini
- Gunakan `onreadystatechange` untuk memantau perubahan state
- State **4** artinya request sudah selesai (berhasil atau gagal)
- Kombinasikan dengan `status` untuk memastikan request berhasil (status 200)

ğŸš€ **Tips**: Dalam praktik modern, banyak developer menggunakan `fetch()` atau library seperti Axios yang lebih mudah digunakan, tapi memahami AJAX XMLHttpRequest tetap penting sebagai fundamental!
